<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  lang="he"
	  dir="rtl">
<body>
<div th:fragment="content">
  <!-- Profile Section -->
  <div class="container-fluid py-4">
	<div class="row">
	  <div class="col-12">
		<div class="card shadow-sm">
		  <div class="card-body">
			<div class="d-flex align-items-center">
			  <img th:if="${picture}"
				   th:src="${picture}"
				   class="rounded-circle me-3"
				   alt="Profile Picture"
				   width="64"
				   height="64">
			  <div>
				<h2 class="card-title mb-1">ברוך הבא, <span th:text="${name}">משתמש</span>!</h2>
				<p class="text-muted mb-0"><strong>דוא״ל:</strong> <span th:text="${email}">email@example.com</span></p>
				<p class="text-muted mb-0">
				  <strong>טלפון:</strong>
				  <span th:if="${phone}"
						th:text="${'0' + #strings.substring(phone, 3)}">
                                        05XXXXXXXX
                                    </span>
				</p>
			  </div>
			</div>
		  </div>
		</div>
	  </div>
	</div>
  </div>
  
  <!-- Statistics and Charts Section -->
  <div class="container-fluid">
	<div class="row g-4">
	  <!-- Statistics Cards -->
	  <div class="col-12">
		<div class="row g-4">
		  <!-- Total Messages Card -->
		  <div class="col-md-3 col-sm-6">
			<div class="card text-center shadow-sm h-100">
			  <div class="card-body">
				<i class="bi bi-chat-dots text-primary" style="font-size: 2rem;"></i>
				<h3 class="mt-2" th:text="${totalMessages}">0</h3>
				<h6 class="text-muted">סה״כ הודעות</h6>
			  </div>
			</div>
		  </div>
		  <!-- Categories Card -->
		  <div class="col-md-3 col-sm-6">
			<div class="card text-center shadow-sm h-100">
			  <div class="card-body">
				<i class="bi bi-folder text-success" style="font-size: 2rem;"></i>
				<h3 class="mt-2" th:text="${categoriesCount}">0</h3>
				<h6 class="text-muted">קטגוריות</h6>
			  </div>
			</div>
		  </div>
		  <!-- Sub-Categories Card -->
		  <div class="col-md-3 col-sm-6">
			<div class="card text-center shadow-sm h-100">
			  <div class="card-body">
				<i class="bi bi-diagram-2 text-info" style="font-size: 2rem;"></i>
				<h3 class="mt-2" th:text="${subCategoriesCount}">0</h3>
				<h6 class="text-muted">תת-קטגוריות</h6>
			  </div>
			</div>
		  </div>
		  <!-- Tags Card -->
		  <div class="col-md-3 col-sm-6">
			<div class="card text-center shadow-sm h-100">
			  <div class="card-body">
				<i class="bi bi-tags text-warning" style="font-size: 2rem;"></i>
				<h3 class="mt-2" th:text="${tagsCount}">0</h3>
				<h6 class="text-muted">תגיות</h6>
			  </div>
			</div>
		  </div>
		</div>
	  </div>
	  
	  <!-- Charts Row -->
	  <div class="col-12">
		<div class="row g-4">
		  <!-- Message Types Chart -->
		  <div class="col-md-6">
			<div class="card shadow-sm h-100">
			  <div class="card-body">
				<h5 class="card-title">סוגי הודעות</h5>
				<div class="position-relative" style="height: 300px;">
				  <canvas id="messageTypesChart"></canvas>
				</div>
				<script th:inline="javascript">
				  document.addEventListener('DOMContentLoaded', function() {
					const ctx = document.getElementById('messageTypesChart').getContext('2d')
					const messageTypes = /*[[${messageTypes}]]*/ {}
					
					new Chart(ctx, {
					  type: 'doughnut',
					  data: {
						labels: ['טקסט', 'תמונות', 'מסמכים', 'אודיו'],
						datasets: [{
						  data: [
							messageTypes.text || 0,
							messageTypes.images || 0,
							messageTypes.documents || 0,
							messageTypes.audio || 0
						  ],
						  backgroundColor: [
							'#36A2EB',
							'#FF6384',
							'#FFCE56',
							'#4BC0C0'
						  ]
						}]
					  },
					  options: {
						responsive: true,
						maintainAspectRatio: false
					  }
					})
				  })
				</script>
			  </div>
			</div>
		  </div>
		  
		  <!-- Next Steps Progress -->
		  <div class="col-md-6">
			<div class="card shadow-sm h-100">
			  <div class="card-body">
				<h5 class="card-title">סטטוס משימות המשך</h5>
				<div class="mt-4">
				  <div th:each="step : ${nextSteps}" class="mb-3">
					<div class="d-flex justify-content-between mb-1">
					  <span th:text="${step.name}">שם המשימה</span>
					  <span th:text="${step.percentage + '%'}">0%</span>
					</div>
					<div class="progress" style="height: 10px;">
					  <div class="progress-bar bg-success" role="progressbar"
						   th:style="'width: ' + ${step.percentage} + '%'"
						   th:aria-valuenow="${step.percentage}"
						   aria-valuemin="0" aria-valuemax="100">
					  </div>
					</div>
				  </div>
				</div>
			  </div>
			</div>
		  </div>
		</div>
	  </div>
	  
	  <!-- Categories Distribution -->
	  <div class="col-12">
		<div class="card shadow-sm">
		  <div class="card-body">
			<h5 class="card-title">התפלגות קטגוריות</h5>
			<div class="position-relative" style="height: 300px;">
			  <canvas id="categoriesChart"></canvas>
			</div>
			<script th:inline="javascript">
			  document.addEventListener('DOMContentLoaded', function() {
				const ctx = document.getElementById('categoriesChart').getContext('2d')
				const categories = /*[[${categoriesData}]]*/ {}
				
				new Chart(ctx, {
				  type: 'bar',
				  data: {
					labels: categories.map(c => c.name),
					datasets: [{
					  label: 'מספר הודעות',
					  data: categories.map(c => c.count),
					  backgroundColor: '#36A2EB'
					}]
				  },
				  options: {
					responsive: true,
					maintainAspectRatio: false,
					scales: {
					  y: {
						beginAtZero: true
					  }
					}
				  }
				})
			  })
			</script>
		  </div>
		</div>
	  </div>
	</div>
  </div>
  
  <!-- WhatsApp Section -->
  <div class="container-fluid mt-4">
	<div class="row">
	  <div class="col-12">
		<div class="card shadow-sm">
		  <div class="card-body text-center">
			<i class="bi bi-whatsapp text-success" style="font-size: 2.5rem;"></i>
			<h5 class="card-title mt-3">התחבר לוואטסאפ</h5>
			<p class="card-text">סרוק את הקוד QR או לחץ על הכפתור למטה כדי להתחיל</p>
			<div class="mb-4" th:if="${qrCodeUrl}">
			  <img th:src="${qrCodeUrl}" alt="WhatsApp QR Code" class="img-fluid" style="max-width: 200px;">
			</div>
			<a th:href="${whatsappLink}" target="_blank" class="btn btn-success">
			  <i class="bi bi-whatsapp me-2"></i>פתח בוואטסאפ
			</a>
		  </div>
		</div>
	  </div>
	</div>
  </div>
</div>
</body>
</html>