<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  lang="he" dir="rtl">
<body>
<div th:fragment="content">
  <!-- Admin Header Section -->
  <div class="container-fluid py-4">
	<div class="row">
	  <div class="col-12">
		<div class="card shadow-whatsapp">
		  <div class="card-body">
			<h2 class="mb-3">ניהול משתמשים</h2>
			<p class="text-muted">נהל הרשאות והגדרות משתמשים במערכת</p>
		  </div>
		</div>
	  </div>
	</div>
  </div>
  
  <!-- User Management Grid -->
  <div class="container-fluid">
	<div class="row g-4">
	  <!-- Create User Card -->
	  <div class="col-lg-6">
		<div class="card shadow-whatsapp">
		  <div class="card-body">
			<h5 class="card-title mb-4">
			  <i class="bi bi-person-plus me-2" style="color: var(--whatsapp-teal)"></i>
			  יצירת משתמש חדש
			</h5>
			<form th:action="@{/admin/create-user}" method="post">
			  <div class="mb-3">
				<label for="newEmail" class="form-label">דוא״ל</label>
				<input type="email" class="form-control" id="newEmail" name="email" required>
			  </div>
			  <div class="mb-3">
				<label for="newName" class="form-label">שם מלא</label>
				<input type="text" class="form-control" id="newName" name="name" required>
			  </div>
			  <div class="mb-3">
				<label for="newPhone" class="form-label">טלפון</label>
				<input type="tel" class="form-control" id="newPhone" name="phone">
			  </div>
			  <div class="mb-3">
				<label for="newRole" class="form-label">תפקיד</label>
				<select class="form-select" id="newRole" name="role" required>
				  <option value="USER">משתמש רגיל</option>
				  <option value="ADMIN">מנהל</option>
				</select>
			  </div>
			  <button type="submit" class="btn btn-success">
				<i class="bi bi-plus-circle me-2"></i>צור משתמש
			  </button>
			</form>
		  </div>
		</div>
	  </div>
	  
	  <!-- Manage Users Card -->
	  <div class="col-lg-6">
		<div class="card shadow-whatsapp">
		  <div class="card-body">
			<h5 class="card-title mb-4">
			  <i class="bi bi-people me-2" style="color: var(--whatsapp-teal)"></i>
			  ניהול משתמשים קיימים
			</h5>
			<div class="table-responsive">
			  <table class="table">
				<thead>
				<tr>
				  <th>שם</th>
				  <th>נוצר בתאריך</th>
				  <th>טלפון</th>
				  <th>דוא״ל</th>
				  <th>תפקיד</th>
				  <th>סטטוס</th>
				  <th>פעולות</th>
				</tr>
				</thead>
				<tbody>
				<tr th:each="user : ${users}">
				  <td><img th:src="${user.getPictureUrl()}" alt="תמונה של המשתמש" /></td>
				  <td th:text="${user.getCreatedAt()}">נוצר ב</td>
				  <td th:text="${user.getWhatsappNumber()}">טלפון</td>
				  <td th:text="${user.getEmail()}">email@example.com</td>
				  <td th:text="${user.getRole()}">USER</td>
				  <td>
					<span th:if="${user.isAuthorized()}" class="badge bg-success">מורשה</span>
					<span th:unless="${user.isAuthorized()}" class="badge bg-danger">לא מורשה</span>
				  </td>
				  <td>
					<div class="btn-group">
					  <form th:action="@{/admin/change-role}"
							method="post"
							class="d-inline">
						<input type="hidden" name="userId" th:value="${user.getId()}">
						<select name="newRole" class="form-select form-select-sm d-inline-block" style="width: auto;" onchange="this.form.submit()">
						  <option th:value="${user.getRole()}" selected>[[${user.getRole()}]]</option>
						  <option th:each="role : ${T(com.organizer.platform.model.User.UserRole).values()}"
								  th:if="${role != user.getRole()}"
								  th:value="${role}"
								  th:text="${role}">
						  </option>
						</select>
					  </form>
					  <form th:if="${user.isAuthorized()}"
							th:action="@{/admin/deauthorize-user}"
							method="post"
							class="me-2">
						<input type="hidden" name="userId" th:value="${user.getId()}">
						<button type="submit" class="btn btn-warning btn-sm">
						  <i class="bi bi-lock"></i>
						</button>
					  </form>
					  <form th:unless="${user.authorized}"
							th:action="@{/admin/authorize-user}"
							method="post"
							class="me-2">
						<input type="hidden" name="userId" th:value="${user.getId()}">
						<button type="submit" class="btn btn-success btn-sm">
						  <i class="bi bi-unlock"></i>
						</button>
					  </form>
					  <form th:action="@{/admin/delete-user}"
							method="post"
							onsubmit="return confirm('האם אתה בטוח שברצונך למחוק משתמש זה?');">
						<input type="hidden" name="userId" th:value="${user.getId()}">
						<button type="submit" class="btn btn-danger btn-sm">
						  <i class="bi bi-trash"></i>
						</button>
					  </form>
					</div>
				  </td>
				</tr>
				</tbody>
			  </table>
			</div>
		  </div>
		</div>
	  </div>
	</div>
  </div>
</div>
</body>
</html>